apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: netbird-turn-config
  namespace: netbird
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  data:
    - secretKey: turnserver_conf
      remoteRef:
        key: netbird/turnserver
        property: turnserver.conf
  target:
    name: netbird-turn-config
    creationPolicy: Owner
    template:
      engineVersion: v2
      type: Opaque
      data:
        turnserver.conf: "{{ .turnserver_conf | toString }}"
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: netbird-relay-env
  namespace: netbird
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  data:
    - secretKey: NB_AUTH_SECRET
      remoteRef:
        key: netbird/environment
        property: NB_AUTH_SECRET
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: netbird-management-config
  namespace: netbird
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  data:
    - secretKey: management.json
      remoteRef:
        key: netbird/management
        property: management.json
