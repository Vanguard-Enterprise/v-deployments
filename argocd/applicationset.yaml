apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: appset
  namespace: devtroncd
spec:
  generators:
  - list:
      elements:
      - name: mgmt
        server: "https://kubernetes.default.svc"
        gitPath: "argocd/applications/mgmt"
      #- name: cluster2
      #  server: "https://cluster2-api.example.com"
      #  gitPath: "argocd/applications/use1"
  template:
    metadata:
      name: "{{name}}-app"
    spec:
      project: default
      source:
        repoURL: "https://github.com/Vanguard-Enterprise/v-deployments"
        targetRevision: main
        # Use the dynamic gitPath from the generator element
        path: "{{gitPath}}"
      destination:
        # Deploy to the cluster specified by the generator
        server: "{{server}}"
        # Namespace where the application should be deployed; adjust as needed
        namespace: default
      syncPolicy:
        automated:
          prune: true
          selfHeal: true